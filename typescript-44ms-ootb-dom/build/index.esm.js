const e=Symbol.for("react-44ms/api/UseServiceSymbol"),l=()=>window[e],t=Symbol.for("react-44ms/api/YieldablePortSymbol"),r=e=>e?._yieldablePort===t,n=Symbol.for("react-44ms/api/RefSymbol"),i=e=>!!e&&e._refSymbol===n,a={element:{name:e=>e},RefPrimitive:{on:e=>({[n]:`${e}`,_refSymbol:n})}},o=Symbol.for("react-44ms/api/YieldableHandlerSymbol"),s=e=>e?._yieldableHandler===o,c=Symbol.for("react-44ms/api/YieldedValueSymbol"),u=Symbol.for("react-44ms/api/YieldedValueNotFoundSymbol"),d=e=>!!e&&e._yieldedValueSymbol===c,f=e=>d(e)?e[c]:u,m=e=>{const{useSubmit:t}=l();return t().submit(e)};m.NO_SUBMIT_FOUND_INVALID_FORM_REASON_KEY=Symbol.for("React44ms/FORM_SUBMIT_INVALID_NO_SUBMIT_KEY");const y=Symbol.for("react-44ms/api/TypedRefSymbol"),b=Symbol.for("react-44ms/api/TypedRefValueSymbol");var p=Object.freeze({__proto__:null,Convenience:a,RefSymbol:n,TypedRefSymbol:y,TypedRefValueSymbol:b,Yield:e=>{const{useReactingPower:t}=l();return t().service.Reactionary.Yield(e)},YieldAValueAtTheEnd:e=>({[c]:e,_yieldedValueSymbol:c}),YieldableHandler:e=>({[o]:e,_yieldableHandler:o}),YieldableHandlerSymbol:o,YieldablePort:e=>({[t]:e,_yieldablePort:t}),YieldablePortSymbol:t,YieldedValueNotFoundSymbol:u,YieldedValueSymbol:c,anyRefishToStringValue:e=>i(e)?e[n]:e||"",anyYieldableHandlerToValue:e=>s(e)?e[o]:"",extractYieldedValue:f,extractYieldingRef:e=>{let l,t,n=[],a=u;if(Array.isArray(e)){const o=(e=(e=(e=e.filter((e=>!s(e)||(t=e,!1)))).filter((e=>!r(e)||(l=e,!1)))).filter((e=>!d(e)||(a=f(e),!1))))[e.length-1];i(o)||(a=o,e=e.slice(0,e.length-1)),n=e}else e&&(n=[e]);return{yieldingCallstackAdditions:n,yieldablePort:l,yieldableHandler:t,yieldedValue:a}},fulfill:{name:e=>e},isThatARef:i,isThatATypedRef:e=>!!e&&e._typedRefSymbol===y,isThatAYieldableHandler:s,isThatAYieldablePort:r,isThatAYieldedValuePrimitive:d,setYourService:l=>{window[e]=l},submit:m,useCallback:(e,t)=>{const{useReactingPower:r}=l();return r().service.Reactionary.useCallback(e,t)},useEffect:(e,t,r)=>{const{useReactingPower:n}=l();return n().service.Reactionary.useEffect(e,t,r)},useFormRefs:e=>{const{useReactingPower:t}=l();return t().service.Reactionary.useFormRefs(e)},useMemo:(e,t)=>{const{useReactingPower:r}=l();return r().service.Reactionary.useMemo(e,t)},useRef:e=>{const{useReactingPower:t}=l();return t().service.Reactionary.useRef(e)},useService:l,useState:e=>{const{useReactingPower:t}=l();return t().service.Reactionary.useState(e)}});const S=Symbol.for("react-44ms/service/crush-kill-destroy"),h=Symbol.for("react-44ms/api/UseServiceSymbol"),R=()=>window[h],_=Symbol.for("react-44ms/api/YieldablePortSymbol"),g=e=>e?._yieldablePort===_,Y=Symbol.for("react-44ms/api/RefSymbol"),v=e=>!!e&&e._refSymbol===Y,E={element:{name:e=>e},RefPrimitive:{on:e=>({[Y]:`${e}`,_refSymbol:Y})}},V=Symbol.for("react-44ms/api/YieldableHandlerSymbol"),P=e=>e?._yieldableHandler===V,T=Symbol.for("react-44ms/api/YieldedValueSymbol"),A=Symbol.for("react-44ms/api/YieldedValueNotFoundSymbol"),F=e=>!!e&&e._yieldedValueSymbol===T,w=e=>F(e)?e[T]:A,O=e=>{const{useSubmit:l}=R();return l().submit(e)};O.NO_SUBMIT_FOUND_INVALID_FORM_REASON_KEY=Symbol.for("React44ms/FORM_SUBMIT_INVALID_NO_SUBMIT_KEY");const C=Symbol.for("react-44ms/api/TypedRefSymbol"),x=Symbol.for("react-44ms/api/TypedRefValueSymbol");var H=Object.freeze({__proto__:null,Convenience:E,RefSymbol:Y,TypedRefSymbol:C,TypedRefValueSymbol:x,Yield:e=>{const{useReactingPower:l}=R();return l().service.Reactionary.Yield(e)},YieldAValueAtTheEnd:e=>({[T]:e,_yieldedValueSymbol:T}),YieldableHandler:e=>({[V]:e,_yieldableHandler:V}),YieldableHandlerSymbol:V,YieldablePort:e=>({[_]:e,_yieldablePort:_}),YieldablePortSymbol:_,YieldedValueNotFoundSymbol:A,YieldedValueSymbol:T,anyRefishToStringValue:e=>v(e)?e[Y]:e||"",anyYieldableHandlerToValue:e=>P(e)?e[V]:"",extractYieldedValue:w,extractYieldingRef:e=>{let l,t,r=[],n=A;if(Array.isArray(e)){const i=(e=(e=(e=e.filter((e=>!P(e)||(t=e,!1)))).filter((e=>!g(e)||(l=e,!1)))).filter((e=>!F(e)||(n=w(e),!1))))[e.length-1];v(i)||(n=i,e=e.slice(0,e.length-1)),r=e}else e&&(r=[e]);return{yieldingCallstackAdditions:r,yieldablePort:l,yieldableHandler:t,yieldedValue:n}},fulfill:{name:e=>e},isThatARef:v,isThatATypedRef:e=>!!e&&e._typedRefSymbol===C,isThatAYieldableHandler:P,isThatAYieldablePort:g,isThatAYieldedValuePrimitive:F,setYourService:e=>{window[h]=e},submit:O,useCallback:(e,l)=>{const{useReactingPower:t}=R();return t().service.Reactionary.useCallback(e,l)},useEffect:(e,l,t)=>{const{useReactingPower:r}=R();return r().service.Reactionary.useEffect(e,l,t)},useFormRefs:e=>{const{useReactingPower:l}=R();return l().service.Reactionary.useFormRefs(e)},useMemo:(e,l)=>{const{useReactingPower:t}=R();return t().service.Reactionary.useMemo(e,l)},useRef:e=>{const{useReactingPower:l}=R();return l().service.Reactionary.useRef(e)},useService:R,useState:e=>{const{useReactingPower:l}=R();return l().service.Reactionary.useState(e)}});let N;!function(e){e.state="state",e.after_rendering="after_rendering"}(N||(N={}));const I=(e,l)=>{const t=e.map((e=>p.anyRefishToStringValue(e).split("."))).flat();let r=l;return t.forEach((e=>{if(e.length>0){const l=r?.children[e];r=l}})),r},M=(e,l)=>{let t=[],r=[];[l,...l?.props?.children?Array.isArray(l.props.children)?l.props.children:[l.props.children]:[]].forEach((e=>{if(e){if("form"===e.type){const l={name:e.props.name,onSubmit:e.props.React44ms_onSubmit};r=[...r,l]}if("input"===e.type&&e.props.React44ms_onChange){const l={name:e.props.name,onChange:e.props.React44ms_onChange};Object.keys(e.props).forEach((t=>{t.startsWith("on")&&t.length>"on".length&&e.props[t]instanceof Function&&(l[t]=e.props[t])})),t=[...t,l]}e.type}}));return{handleEvent:e=>{const l=(e=>{let l;if(e){const r=t.find((l=>l.name===e[p.YieldablePortSymbol]));r&&(l=r)}else{const e=t.find((e=>!e.name));e&&(l=e);const r=t.length>0?t[0]:void 0;!l&&r&&(l=r)}return l})(e.yieldablePort);let r=p.anyYieldableHandlerToValue(e.yieldableHandler);const n=!r||r.length<1,i=e.yieldedValue!==p.YieldedValueNotFoundSymbol;if(n&&i&&(r="onChange"),"onChange"===r){const t=l?.onChange;t?.({target:{value:e.yieldedValue}})}else{const e=l?.[r];e?.()}},handleSubmit:(l,t)=>{const n=(e=>{let l=[];if(e){const t=r.find((l=>l.name===e[p.YieldablePortSymbol]));t&&(l=[...l,t])}else l=[...r];return l})(l.yieldablePort),i={expect:e};n.forEach((e=>{try{e.onSubmit?.(i)}catch(l){t(l,e.name)}}))}}},k=(e,l,t,r)=>{const n=I(t,r);n.rendered=l,n.gateway=M(e,l),n.latestOutputs&&(n.lastOutputs=n.latestOutputs,n.latestOutputs=void 0),n.latestFulfillment&&(n.lastFulfillment=n.latestFulfillment,n.latestFulfillment=void 0),n.latestExplicitChildren&&(n.lastExplicitChildren=n.latestExplicitChildren,n.latestExplicitChildren=null);const i=j(l);return n.latestOutputs=i,n.latestFulfillment=(e=>{let l={};return(e?.props?.children?Array.isArray(e.props.children)?e.props.children:[e.props.children]:[]).forEach((e=>{if(e&&"fulfill"===e.type){const t={[e.props.name]:e.props.handler};l={...l,...t}}})),l})(l),n.latestExplicitChildren=(e=>{let l=[];return(e?.props?.children?Array.isArray(e.props.children)?e.props.children:[e.props.children]:[]).forEach((e=>{if(e&&e.type instanceof Function){const t=e.ref;l=[...l,t]}})),l})(l),n},j=e=>{let l=[];return(e?.props?.children?Array.isArray(e.props.children)?e.props.children:[e.props.children]:[]).forEach((e=>{if(e&&"output"===e.type){const t={name:e.props.name,value:e.props.React44ms_value};l=[...l,t]}})),l},U=(e,l,t,r,n)=>{if(n===S)return l(r,void 0,S),void t(r,void 0,S);(n.lastOutputs||[]).forEach((e=>{(n.latestOutputs||[]).find((l=>l.name===e.name))||l(r,S,e.name)})),(n.latestOutputs||[]).forEach((e=>{const t=(n.lastOutputs||[]).find((l=>l.name===e.name));t&&t?.value===e.value||l(r,e.value,e.name)})),Object.entries(n.lastFulfillment||{}).forEach((e=>{const[l]=e;Object.entries(n.latestFulfillment||{}).find((([e])=>e===l))||t(r,S,l)})),Object.entries(n.latestFulfillment||{}).forEach((e=>{const[l,i]=e,a=(n.lastFulfillment||{})[l];a&&a===i||t(r,i,l)}))},D=(e,l,t)=>{const{publicFormStateImmediate:r,siphonPublicFinal:n,siphonPublicFulfillmentFinal:i}=l,a=(e,l)=>{const t=((e,l)=>{const t=l[H.RefSymbol].split(".");let r=e;return t.forEach((e=>{e&&e.length>0&&(r=r?.[e])})),r})(r(),e);return t||l};let o=null,s=[],c=[];const u={begin_context:e=>{c=[...e?[e]:[],...c],t.work_reconcile_state()},createElement:(e,l)=>{if(!o){const e={[p.RefSymbol]:`${[].join(".")}`,_refSymbol:p.RefSymbol};o={children:{},ref:e,latestExplicitChildren:null,lastExplicitChildren:null}}const t=((e,l)=>{const t=e.map((e=>p.anyRefishToStringValue(e).split("."))).flat();let r=l;return t.forEach(((e,l)=>{if(!r.children[e]){const n={children:{},ref:{[p.RefSymbol]:`${t.slice(0,l+1).join(".")}`,_refSymbol:p.RefSymbol},lastExplicitChildren:null,latestExplicitChildren:null};r.children[e]=n}r=r.children[e]})),r})(c,o);t.type=e,t.props=l},end_context:l=>{const r=k(a,l,c,o);let u=[];let d=[];U(0,((e,l,t)=>{const r=[...e];u=[...u,()=>{n(r,l,t)}]}),((e,l,t)=>{const r=[...e];d=[...d,()=>{i(r,l,t)}]}),c,r);const f=[...c];return s=[...s,()=>{t.work_after_rendering()},()=>{t.work_reconcile_state()},()=>{if(u.forEach((e=>{e()})),u.length>0){const l=f.map((e=>p.anyRefishToStringValue(e).split("."))).flat(),t={[p.RefSymbol]:`${l.join(".")}`,_refSymbol:p.RefSymbol};e.public_form_state_ready(t)}if(d.forEach((e=>{e()})),d.length>0){const l=f.map((e=>p.anyRefishToStringValue(e).split("."))).flat(),t={[p.RefSymbol]:`${l.join(".")}`,_refSymbol:p.RefSymbol};e.public_form_fulfillment_ready(t)}}],c=c.slice(1),r},effects:()=>{const e=s;s=[],e.forEach((e=>{e()}))},crush_kill_destroy:l=>{if(!o)return;((e,l)=>{const t=[e].map((e=>p.anyRefishToStringValue(e).split("."))).flat();let r=l;t.forEach(((e,l)=>{l===t.length-1?delete r.children[e]:r=r.children[e]}))})(l,o);let t=[];let r=[];U(0,((e,l,r)=>{const i=[...e];t=[...t,()=>{n(i,l,r)}]}),((e,l,t)=>{const n=[...e];r=[...r,()=>{i(n,l,t)}]}),[l],S);s=[...s,()=>{t.forEach((e=>{e()})),t.length>0&&e.public_form_state_ready(l),r.forEach((e=>{e()})),r.length>0&&e.public_form_fulfillment_ready(l)}]}};return{explorer:(e,l)=>{if(!o)return null;const t=[...l||[]],r=I(t,o)?.gateway;return r||null},exploreRefs:e=>{if(!o)return null;const l=I([e],o);return l||null},virtualDomController:u,giveCurrentRefStack:()=>c}};export{D as ootbDom};
//# sourceMappingURL=index.esm.js.map

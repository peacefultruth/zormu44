"use strict";const e=Symbol.for("react-44ms/api/UseServiceSymbol"),l=()=>window[e],t=Symbol.for("react-44ms/api/YieldablePortSymbol"),r=e=>e?._yieldablePort===t,i=Symbol.for("react-44ms/api/RefSymbol"),n=e=>!!e&&e._refSymbol===i,o={element:{name:e=>e},RefPrimitive:{on:e=>({[i]:`${e}`,_refSymbol:i})}},a=Symbol.for("react-44ms/api/YieldableHandlerSymbol"),s=e=>e?._yieldableHandler===a,c=Symbol.for("react-44ms/api/YieldedValueSymbol"),u=Symbol.for("react-44ms/api/YieldedValueNotFoundSymbol"),d=e=>!!e&&e._yieldedValueSymbol===c,f=e=>d(e)?e[c]:u,m=e=>{const{useSubmit:t}=l();return t().submit(e)};m.NO_SUBMIT_FOUND_INVALID_FORM_REASON_KEY=Symbol.for("React44ms/FORM_SUBMIT_INVALID_NO_SUBMIT_KEY");const y=Symbol.for("react-44ms/api/TypedRefSymbol"),b=Symbol.for("react-44ms/api/TypedRefValueSymbol");var p=Object.freeze({__proto__:null,Convenience:o,RefSymbol:i,TypedRefSymbol:y,TypedRefValueSymbol:b,Yield:e=>{const{useReactingPower:t}=l();return t().service.Reactionary.Yield(e)},YieldAValueAtTheEnd:e=>({[c]:e,_yieldedValueSymbol:c}),YieldableHandler:e=>({[a]:e,_yieldableHandler:a}),YieldableHandlerSymbol:a,YieldablePort:e=>({[t]:e,_yieldablePort:t}),YieldablePortSymbol:t,YieldedValueNotFoundSymbol:u,YieldedValueSymbol:c,anyRefishToStringValue:e=>n(e)?e[i]:e||"",anyYieldableHandlerToValue:e=>s(e)?e[a]:"",extractYieldedValue:f,extractYieldingRef:e=>{let l,t,i=[],o=u;if(Array.isArray(e)){const a=(e=(e=(e=e.filter((e=>!s(e)||(t=e,!1)))).filter((e=>!r(e)||(l=e,!1)))).filter((e=>!d(e)||(o=f(e),!1))))[e.length-1];n(a)||(o=a,e=e.slice(0,e.length-1)),i=e}else e&&(i=[e]);return{yieldingCallstackAdditions:i,yieldablePort:l,yieldableHandler:t,yieldedValue:o}},fulfill:{name:e=>e},isThatARef:n,isThatATypedRef:e=>!!e&&e._typedRefSymbol===y,isThatAYieldableHandler:s,isThatAYieldablePort:r,isThatAYieldedValuePrimitive:d,setYourService:l=>{window[e]=l},submit:m,useCallback:(e,t)=>{const{useReactingPower:r}=l();return r().service.Reactionary.useCallback(e,t)},useEffect:(e,t,r)=>{const{useReactingPower:i}=l();return i().service.Reactionary.useEffect(e,t,r)},useFormRefs:e=>{const{useReactingPower:t}=l();return t().service.Reactionary.useFormRefs(e)},useMemo:(e,t)=>{const{useReactingPower:r}=l();return r().service.Reactionary.useMemo(e,t)},useRef:e=>{const{useReactingPower:t}=l();return t().service.Reactionary.useRef(e)},useService:l,useState:e=>{const{useReactingPower:t}=l();return t().service.Reactionary.useState(e)}});const S=Symbol.for("react-44ms/service/crush-kill-destroy"),h=Symbol.for("react-44ms/api/UseServiceSymbol"),R=()=>window[h],_=Symbol.for("react-44ms/api/YieldablePortSymbol"),g=e=>e?._yieldablePort===_,Y=Symbol.for("react-44ms/api/RefSymbol"),v=e=>!!e&&e._refSymbol===Y,E={element:{name:e=>e},RefPrimitive:{on:e=>({[Y]:`${e}`,_refSymbol:Y})}},V=Symbol.for("react-44ms/api/YieldableHandlerSymbol"),P=e=>e?._yieldableHandler===V,T=Symbol.for("react-44ms/api/YieldedValueSymbol"),A=Symbol.for("react-44ms/api/YieldedValueNotFoundSymbol"),F=e=>!!e&&e._yieldedValueSymbol===T,w=e=>F(e)?e[T]:A,O=e=>{const{useSubmit:l}=R();return l().submit(e)};O.NO_SUBMIT_FOUND_INVALID_FORM_REASON_KEY=Symbol.for("React44ms/FORM_SUBMIT_INVALID_NO_SUBMIT_KEY");const C=Symbol.for("react-44ms/api/TypedRefSymbol"),x=Symbol.for("react-44ms/api/TypedRefValueSymbol");var H=Object.freeze({__proto__:null,Convenience:E,RefSymbol:Y,TypedRefSymbol:C,TypedRefValueSymbol:x,Yield:e=>{const{useReactingPower:l}=R();return l().service.Reactionary.Yield(e)},YieldAValueAtTheEnd:e=>({[T]:e,_yieldedValueSymbol:T}),YieldableHandler:e=>({[V]:e,_yieldableHandler:V}),YieldableHandlerSymbol:V,YieldablePort:e=>({[_]:e,_yieldablePort:_}),YieldablePortSymbol:_,YieldedValueNotFoundSymbol:A,YieldedValueSymbol:T,anyRefishToStringValue:e=>v(e)?e[Y]:e||"",anyYieldableHandlerToValue:e=>P(e)?e[V]:"",extractYieldedValue:w,extractYieldingRef:e=>{let l,t,r=[],i=A;if(Array.isArray(e)){const n=(e=(e=(e=e.filter((e=>!P(e)||(t=e,!1)))).filter((e=>!g(e)||(l=e,!1)))).filter((e=>!F(e)||(i=w(e),!1))))[e.length-1];v(n)||(i=n,e=e.slice(0,e.length-1)),r=e}else e&&(r=[e]);return{yieldingCallstackAdditions:r,yieldablePort:l,yieldableHandler:t,yieldedValue:i}},fulfill:{name:e=>e},isThatARef:v,isThatATypedRef:e=>!!e&&e._typedRefSymbol===C,isThatAYieldableHandler:P,isThatAYieldablePort:g,isThatAYieldedValuePrimitive:F,setYourService:e=>{window[h]=e},submit:O,useCallback:(e,l)=>{const{useReactingPower:t}=R();return t().service.Reactionary.useCallback(e,l)},useEffect:(e,l,t)=>{const{useReactingPower:r}=R();return r().service.Reactionary.useEffect(e,l,t)},useFormRefs:e=>{const{useReactingPower:l}=R();return l().service.Reactionary.useFormRefs(e)},useMemo:(e,l)=>{const{useReactingPower:t}=R();return t().service.Reactionary.useMemo(e,l)},useRef:e=>{const{useReactingPower:l}=R();return l().service.Reactionary.useRef(e)},useService:R,useState:e=>{const{useReactingPower:l}=R();return l().service.Reactionary.useState(e)}});let N;!function(e){e.state="state",e.after_rendering="after_rendering"}(N||(N={}));const I=(e,l)=>{const t=e.map((e=>p.anyRefishToStringValue(e).split("."))).flat();let r=l;return t.forEach((e=>{if(e.length>0){const l=r?.children[e];r=l}})),r},M=(e,l)=>{let t=[],r=[];[l,...l?.props?.children?Array.isArray(l.props.children)?l.props.children:[l.props.children]:[]].forEach((e=>{if(e){if("form"===e.type){const l={name:e.props.name,onSubmit:e.props.React44ms_onSubmit};r=[...r,l]}if("input"===e.type&&e.props.React44ms_onChange){const l={name:e.props.name,onChange:e.props.React44ms_onChange};Object.keys(e.props).forEach((t=>{t.startsWith("on")&&t.length>"on".length&&e.props[t]instanceof Function&&(l[t]=e.props[t])})),t=[...t,l]}e.type}}));return{handleEvent:e=>{const l=(e=>{let l;if(e){const r=t.find((l=>l.name===e[p.YieldablePortSymbol]));r&&(l=r)}else{const e=t.find((e=>!e.name));e&&(l=e);const r=t.length>0?t[0]:void 0;!l&&r&&(l=r)}return l})(e.yieldablePort);let r=p.anyYieldableHandlerToValue(e.yieldableHandler);const i=!r||r.length<1,n=e.yieldedValue!==p.YieldedValueNotFoundSymbol;if(i&&n&&(r="onChange"),"onChange"===r){const t=l?.onChange;t?.({target:{value:e.yieldedValue}})}else{const e=l?.[r];e?.()}},handleSubmit:(l,t)=>{const i=(e=>{let l=[];if(e){const t=r.find((l=>l.name===e[p.YieldablePortSymbol]));t&&(l=[...l,t])}else l=[...r];return l})(l.yieldablePort),n={expect:e};i.forEach((e=>{try{e.onSubmit?.(n)}catch(l){t(l,e.name)}}))}}},k=(e,l,t,r)=>{const i=I(t,r);i.rendered=l,i.gateway=M(e,l),i.latestOutputs&&(i.lastOutputs=i.latestOutputs,i.latestOutputs=void 0),i.latestFulfillment&&(i.lastFulfillment=i.latestFulfillment,i.latestFulfillment=void 0),i.latestExplicitChildren&&(i.lastExplicitChildren=i.latestExplicitChildren,i.latestExplicitChildren=null);const n=j(l);return i.latestOutputs=n,i.latestFulfillment=(e=>{let l={};return(e?.props?.children?Array.isArray(e.props.children)?e.props.children:[e.props.children]:[]).forEach((e=>{if(e&&"fulfill"===e.type){const t={[e.props.name]:e.props.handler};l={...l,...t}}})),l})(l),i.latestExplicitChildren=(e=>{let l=[];return(e?.props?.children?Array.isArray(e.props.children)?e.props.children:[e.props.children]:[]).forEach((e=>{if(e&&e.type instanceof Function){const t=e.ref;l=[...l,t]}})),l})(l),i},j=e=>{let l=[];return(e?.props?.children?Array.isArray(e.props.children)?e.props.children:[e.props.children]:[]).forEach((e=>{if(e&&"output"===e.type){const t={name:e.props.name,value:e.props.React44ms_value};l=[...l,t]}})),l},U=(e,l,t,r,i)=>{if(i===S)return l(r,void 0,S),void t(r,void 0,S);(i.lastOutputs||[]).forEach((e=>{(i.latestOutputs||[]).find((l=>l.name===e.name))||l(r,S,e.name)})),(i.latestOutputs||[]).forEach((e=>{const t=(i.lastOutputs||[]).find((l=>l.name===e.name));t&&t?.value===e.value||l(r,e.value,e.name)})),Object.entries(i.lastFulfillment||{}).forEach((e=>{const[l]=e;Object.entries(i.latestFulfillment||{}).find((([e])=>e===l))||t(r,S,l)})),Object.entries(i.latestFulfillment||{}).forEach((e=>{const[l,n]=e,o=(i.lastFulfillment||{})[l];o&&o===n||t(r,n,l)}))};exports.ootbDom=(e,l,t)=>{const{publicFormStateImmediate:r,siphonPublicFinal:i,siphonPublicFulfillmentFinal:n}=l,o=(e,l)=>{const t=((e,l)=>{const t=l[H.RefSymbol].split(".");let r=e;return t.forEach((e=>{e&&e.length>0&&(r=r?.[e])})),r})(r(),e);return t||l};let a=null,s=[],c=[];const u={begin_context:e=>{c=[...e?[e]:[],...c],t.work_reconcile_state()},createElement:(e,l)=>{if(!a){const e={[p.RefSymbol]:`${[].join(".")}`,_refSymbol:p.RefSymbol};a={children:{},ref:e,latestExplicitChildren:null,lastExplicitChildren:null}}const t=((e,l)=>{const t=e.map((e=>p.anyRefishToStringValue(e).split("."))).flat();let r=l;return t.forEach(((e,l)=>{if(!r.children[e]){const i={children:{},ref:{[p.RefSymbol]:`${t.slice(0,l+1).join(".")}`,_refSymbol:p.RefSymbol},lastExplicitChildren:null,latestExplicitChildren:null};r.children[e]=i}r=r.children[e]})),r})(c,a);t.type=e,t.props=l},end_context:l=>{const r=k(o,l,c,a);let u=[];let d=[];U(0,((e,l,t)=>{const r=[...e];u=[...u,()=>{i(r,l,t)}]}),((e,l,t)=>{const r=[...e];d=[...d,()=>{n(r,l,t)}]}),c,r);const f=[...c];return s=[...s,()=>{t.work_after_rendering()},()=>{t.work_reconcile_state()},()=>{if(u.forEach((e=>{e()})),u.length>0){const l=f.map((e=>p.anyRefishToStringValue(e).split("."))).flat(),t={[p.RefSymbol]:`${l.join(".")}`,_refSymbol:p.RefSymbol};e.public_form_state_ready(t)}if(d.forEach((e=>{e()})),d.length>0){const l=f.map((e=>p.anyRefishToStringValue(e).split("."))).flat(),t={[p.RefSymbol]:`${l.join(".")}`,_refSymbol:p.RefSymbol};e.public_form_fulfillment_ready(t)}}],c=c.slice(1),r},effects:()=>{const e=s;s=[],e.forEach((e=>{e()}))},crush_kill_destroy:l=>{if(!a)return;((e,l)=>{const t=[e].map((e=>p.anyRefishToStringValue(e).split("."))).flat();let r=l;t.forEach(((e,l)=>{l===t.length-1?delete r.children[e]:r=r.children[e]}))})(l,a);let t=[];let r=[];U(0,((e,l,r)=>{const n=[...e];t=[...t,()=>{i(n,l,r)}]}),((e,l,t)=>{const i=[...e];r=[...r,()=>{n(i,l,t)}]}),[l],S);s=[...s,()=>{t.forEach((e=>{e()})),t.length>0&&e.public_form_state_ready(l),r.forEach((e=>{e()})),r.length>0&&e.public_form_fulfillment_ready(l)}]}};return{explorer:(e,l)=>{if(!a)return null;const t=[...l||[]],r=I(t,a)?.gateway;return r||null},exploreRefs:e=>{if(!a)return null;const l=I([e],a);return l||null},virtualDomController:u,giveCurrentRefStack:()=>c}};
//# sourceMappingURL=index.cjs.js.map
